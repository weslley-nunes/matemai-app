# Mapeamento de Assets do Avatar (DiceBear Avataaars) - v1.1

AVATAR_ASSETS = {
    "top": [
        {"id": "shortFlat", "name": "Cabelo Curto", "level": 1},
        {"id": "longButNotTooLong", "name": "Cabelo Longo", "level": 1},
        {"id": "hat", "name": "Chapéu", "level": 5, "price": 500},
        {"id": "hijab", "name": "Hijab", "level": 1},
        {"id": "turban", "name": "Turbante", "level": 1},
        {"id": "winterHat1", "name": "Touca de Inverno", "level": 5, "price": 400},
        {"id": "winterHat02", "name": "Touca com Pompom", "level": 8, "price": 800},
        {"id": "bob", "name": "Corte Bob", "level": 1},
        {"id": "bun", "name": "Coque", "level": 1},
        {"id": "curly", "name": "Encaracolado", "level": 1},
        {"id": "curvy", "name": "Ondulado", "level": 1},
        {"id": "dreads", "name": "Dreads", "level": 1},
        {"id": "frida", "name": "Frida", "level": 10, "price": 1000},
        {"id": "fro", "name": "Black Power", "level": 1},
        {"id": "froBand", "name": "Black Power com Faixa", "level": 3, "price": 300},
        {"id": "miaWallace", "name": "Mia Wallace", "level": 5, "price": 500},
        {"id": "shavedSides", "name": "Laterais Raspadas", "level": 4, "price": 400},
        {"id": "straight01", "name": "Liso 1", "level": 1},
        {"id": "straight02", "name": "Liso 2", "level": 1},
        {"id": "theCaesar", "name": "Corte Caesar", "level": 1},
    ],
    "accessories": [
        {"id": "", "name": "Sem Acessórios", "level": 1},
        {"id": "eyepatch", "name": "Tapa-Olho", "level": 3, "price": 300},
        {"id": "kurt", "name": "Óculos Kurt", "level": 5, "price": 500},
        {"id": "prescription01", "name": "Óculos Grau 1", "level": 1},
        {"id": "prescription02", "name": "Óculos Grau 2", "level": 1},
        {"id": "round", "name": "Óculos Redondos", "level": 1},
        {"id": "sunglasses", "name": "Óculos Escuros", "level": 10, "price": 1000},
        {"id": "wayfarers", "name": "Wayfarers", "level": 5, "price": 500},
    ],
    "hairColor": [
        {"id": "a55728", "name": "Ruivo Escuro", "level": 1},
        {"id": "2c1b18", "name": "Preto", "level": 1},
        {"id": "b58143", "name": "Loiro", "level": 1},
        {"id": "d6b370", "name": "Loiro Dourado", "level": 1},
        {"id": "724133", "name": "Castanho", "level": 1},
        {"id": "4a312c", "name": "Castanho Escuro", "level": 1},
        {"id": "f59797", "name": "Rosa Pastel", "level": 5, "price": 500},
        {"id": "ecdcbf", "name": "Platinado", "level": 3, "price": 300},
        {"id": "c93305", "name": "Vermelho", "level": 1},
        {"id": "e8e1e1", "name": "Grisalho", "level": 1},
    ],
    "clothing": [
        {"id": "blazerAndShirt", "name": "Blazer e Camisa", "level": 5, "price": 600},
        {"id": "blazerAndSweater", "name": "Blazer e Suéter", "level": 3, "price": 400},
        {"id": "collarAndSweater", "name": "Gola e Suéter", "level": 1},
        {"id": "graphicShirt", "name": "Camiseta Estampada", "level": 1},
        {"id": "hoodie", "name": "Moletom", "level": 2},
        {"id": "overall", "name": "Macacão", "level": 1},
        {"id": "shirtCrewNeck", "name": "Camiseta Gola Careca", "level": 1},
        {"id": "shirtScoopNeck", "name": "Camiseta Gola U", "level": 1},
        {"id": "shirtVNeck", "name": "Camiseta Gola V", "level": 1},
    ],
    "eyes": [
        {"id": "cry", "name": "Chorando", "level": 1},
        {"id": "default", "name": "Normais", "level": 1},
        {"id": "eyeRoll", "name": "Revirando", "level": 2},
        {"id": "happy", "name": "Feliz", "level": 1},
        {"id": "hearts", "name": "Apaixonado", "level": 5, "price": 500},
        {"id": "side", "name": "Olhando de Lado", "level": 1},
        {"id": "squint", "name": "Semicerrados", "level": 1},
        {"id": "surprised", "name": "Surpreso", "level": 1},
        {"id": "wink", "name": "Piscadinha", "level": 3, "price": 300},
        {"id": "winkWacky", "name": "Piscadinha Louca", "level": 4, "price": 400},
    ],
    "eyebrows": [
        {"id": "angry", "name": "Bravo", "level": 1},
        {"id": "angryNatural", "name": "Bravo Natural", "level": 1},
        {"id": "default", "name": "Normal", "level": 1},
        {"id": "defaultNatural", "name": "Normal Natural", "level": 1},
        {"id": "flatNatural", "name": "Reto", "level": 1},
        {"id": "raisedExcited", "name": "Animado", "level": 1},
        {"id": "sadConcerned", "name": "Preocupado", "level": 1},
        {"id": "sadConcernedNatural", "name": "Preocupado Natural", "level": 1},
        {"id": "unibrowNatural", "name": "Monocelha", "level": 1},
        {"id": "upDown", "name": "Cético", "level": 1},
        {"id": "upDownNatural", "name": "Cético Natural", "level": 1},
    ],
    "mouth": [
        {"id": "concerned", "name": "Preocupado", "level": 1},
        {"id": "default", "name": "Normal", "level": 1},
        {"id": "disbelief", "name": "Incrédulo", "level": 1},
        {"id": "eating", "name": "Comendo", "level": 1},
        {"id": "grimace", "name": "Careta", "level": 1},
        {"id": "sad", "name": "Triste", "level": 1},
        {"id": "screamOpen", "name": "Gritando", "level": 1},
        {"id": "serious", "name": "Sério", "level": 1},
        {"id": "smile", "name": "Sorriso", "level": 1},
        {"id": "tongue", "name": "Língua", "level": 2},
        {"id": "twinkle", "name": "Sorriso Maroto", "level": 3, "price": 300},
        {"id": "vomit", "name": "Enjoado", "level": 1},
    ],
    "skinColor": [
        {"id": "fd9841", "name": "Bronzeado", "level": 1},
        {"id": "f8d25c", "name": "Amarelo", "level": 1},
        {"id": "ffdbb4", "name": "Pálido", "level": 1},
        {"id": "edb98a", "name": "Claro", "level": 1},
        {"id": "d08b5b", "name": "Marrom", "level": 1},
        {"id": "ae5d29", "name": "Marrom Escuro", "level": 1},
        {"id": "614335", "name": "Negro", "level": 1},
    ]
}

def get_avatar_url(config):
    """
    Gera a URL do DiceBear com base na configuração.
    """
    base_url = "https://api.dicebear.com/9.x/avataaars/svg"
    params = []
    
    # Use a seed based on the configuration to ensure consistency
    # If config is empty, use a random seed or a default one
    import json
    import hashlib
    
    if not config:
        seed = "Felix" # Default seed
    else:
        # Create a deterministic seed from the config
        config_str = json.dumps(config, sort_keys=True)
        seed = hashlib.md5(config_str.encode()).hexdigest()
    
    params.append(f"seed={seed}")
    params.append("accessoriesProbability=100")
    
    # Iterate over all config items, excluding special internal keys or reserved URL params
    # This restores flexibility while still filtering empty values
    for key, value in config.items():
        if key in ["seed"]: # seed is handled separately
            continue
        if value:
            # Basic validation: ensure key is alphanumeric to prevent injection, though less critical here
            params.append(f"{key}={value}")
            
    return f"{base_url}?{'&'.join(params)}"

def generate_random_avatar_config():
    """
    Gera uma configuração de avatar aleatória com itens de nível 1.
    """
    import random
    
    config = {}
    
    # Iterate over categories in AVATAR_ASSETS
    for category, items in AVATAR_ASSETS.items():
        # Filter items that are level 1 (unlocked by default)
        level_1_items = [item for item in items if item["level"] == 1]
        
        if level_1_items:
            selected_item = random.choice(level_1_items)
            config[category] = selected_item["id"]
            
    return config

def get_shop_items():
    """
    Retorna uma lista de todos os itens compráveis (que possuem preço).
    """
    shop_items = []
    
    for category, items in AVATAR_ASSETS.items():
        for item in items:
            if "price" in item:
                # Cria uma cópia do item e adiciona a categoria
                shop_item = item.copy()
                shop_item["category"] = category
                shop_items.append(shop_item)
                
    return shop_items
